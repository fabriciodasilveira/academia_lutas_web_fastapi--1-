{% extends "base.html" %}

{% block title %}
{% if turma %}Editar Turma{% else %}Nova Turma{% endif %} - Academia de Lutas
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="h3 mb-0">
                <i class="fas fa-users-cog me-2"></i>
                {% if turma %}Editar Turma{% else %}Nova Turma{% endif %}
            </h1>
            <a href="{{ url_for('turmas_list') }}" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left me-1"></i>
                Voltar
            </a>
        </div>
    </div>
</div>

<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-transparent border-0">
                <h5 class="card-title mb-0">
                    <i class="fas fa-info-circle me-2"></i>
                    Informações da Turma
                </h5>
            </div>
            <div class="card-body">
                <form action="{{ url_for('turmas_salvar') }}" method="POST">
                    {% if turma %}
                    <input type="hidden" name="id" value="{{ turma.id }}">
                    {% endif %}
                    
                    <div class="row g-3">
                        <div class="col-md-12">
                            <label for="nome" class="form-label">Nome da Turma</label>
                            <input type="text" class="form-control" id="nome" name="nome" value="{{ turma.nome if turma }}" required>
                        </div>

                        <div class="col-md-6">
                            <label for="modalidade" class="form-label">Modalidade</label>
                            <select class="form-select" id="modalidade" name="modalidade" required>
                                <option value="">Selecione a modalidade</option>
                                <option value="jiu-jitsu" {% if turma and turma.modalidade == 'jiu-jitsu' %}selected{% endif %}>Jiu-Jitsu</option>
                                <option value="muay-thai" {% if turma and turma.modalidade == 'muay-thai' %}selected{% endif %}>Muay Thai</option>
                                <option value="boxe" {% if turma and turma.modalidade == 'boxe' %}selected{% endif %}>Boxe</option>
                                <option value="mma" {% if turma and turma.modalidade == 'mma' %}selected{% endif %}>MMA</option>
                                <option value="yoga" {% if turma and turma.modalidade == 'yoga' %}selected{% endif %}>Yoga</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="nivel" class="form-label">Nível</label>
                            <select class="form-select" id="nivel" name="nivel" required>
                                <option value="">Selecione o nível</option>
                                <option value="iniciante" {% if turma and turma.nivel == 'iniciante' %}selected{% endif %}>Iniciante</option>
                                <option value="intermediario" {% if turma and turma.nivel == 'intermediario' %}selected{% endif %}>Intermediário</option>
                                <option value="avancado" {% if turma and turma.nivel == 'avancado' %}selected{% endif %}>Avançado</option>
                                <option value="misto" {% if turma and turma.nivel == 'misto' %}selected{% endif %}>Misto</option>
                            </select>
                        </div>
                        
                        <div class="col-md-12">
                            <label for="professor_id" class="form-label">Professor</label>
                            <select class="form-select" id="professor_id" name="professor_id">
                                <option value="">Selecione o professor</option>
                                {% for professor in professores %}
                                    <option 
                                        value="{{ professor.id }}" 
                                        data-especialidade="{{ professor.especialidade }}"
                                        {% if turma and turma.professor_id == professor.id %}selected{% endif %}>
                                        {{ professor.nome }} - {{ professor.especialidade }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <div class="col-md-6">
                            <label for="horario" class="form-label">Horário</label>
                            <input type="text" class="form-control" id="horario" name="horario" value="{{ turma.horario if turma }}">
                        </div>
                        <div class="col-md-6">
                            <label for="capacidade_maxima" class="form-label">Capacidade Máxima</label>
                            <input type="number" class="form-control" id="capacidade_maxima" name="capacidade_maxima" value="{{ turma.capacidade_maxima if turma }}">
                        </div>
                        
                        <div class="col-md-6">
                            <label for="valor_mensalidade" class="form-label">Valor da Mensalidade</label>
                            <div class="input-group">
                                <span class="input-group-text">R$</span>
                                <input type="number" step="0.01" class="form-control" id="valor_mensalidade" name="valor_mensalidade" value="{{ '%.2f'|format(turma.valor_mensalidade) if turma and turma.valor_mensalidade is not none }}">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label for="idade_minima" class="form-label">Idade Mínima</label>
                            <input type="number" class="form-control" id="idade_minima" name="idade_minima" value="{{ turma.idade_minima if turma }}">
                        </div>

                        <div class="col-md-12 form-check form-switch mt-3">
                            <input class="form-check-input" type="checkbox" role="switch" id="ativa" name="ativa" value="1" {% if turma and turma.ativa %}checked{% endif %}>
                            <label class="form-check-label" for="ativa">Turma Ativa</label>
                        </div>
                        
                        <div class="col-md-12">
                            <label for="descricao" class="form-label">Descrição</label>
                            <textarea class="form-control" id="descricao" name="descricao" rows="3">{{ turma.descricao if turma }}</textarea>
                        </div>
                        <div class="col-md-12">
                            <label for="observacoes" class="form-label">Observações</label>
                            <textarea class="form-control" id="observacoes" name="observacoes" rows="3">{{ turma.observacoes if turma }}</textarea>
                        </div>
                    </div>
                    
                    <div class="mt-4 d-flex justify-content-end">
                        <button type="submit" class="btn btn-info me-2">
                            <i class="fas fa-save me-1"></i>
                            Salvar Turma
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const modalidadeSelect = document.getElementById('modalidade');
    const professorSelect = document.getElementById('professor_id');
    const professorOptions = professorSelect.querySelectorAll('option[data-especialidade]');
    
    // Inicializa a lista de professores com base na modalidade pré-selecionada (se houver)
    filterProfessors(modalidadeSelect.value);

    // Adiciona o evento de 'change' para a seleção da modalidade
    modalidadeSelect.addEventListener('change', function() {
        const selectedModalidade = this.value;
        filterProfessors(selectedModalidade);
    });

    function filterProfessors(modalidade) {
        // Normaliza a modalidade selecionada para comparação
        const normalizedModalidade = modalidade ? modalidade.toLowerCase().replace('-', ' ') : null;

        // Limpa a seleção atual do professor
        professorSelect.value = '';
        
        // Exibe ou esconde os professores baseados na especialidade
        professorOptions.forEach(option => {
            const especialidade = option.dataset.especialidade;
            // Normaliza a especialidade do professor para comparação
            const normalizedEspecialidade = especialidade ? especialidade.toLowerCase().replace('-', ' ') : null;

            // Se nenhuma modalidade for selecionada, ou se a especialidade corresponder
            if (!normalizedModalidade || normalizedEspecialidade === normalizedModalidade) {
                option.style.display = '';
            } else {
                option.style.display = 'none';
            }
        });
    }
});
</script>
{% endblock %}